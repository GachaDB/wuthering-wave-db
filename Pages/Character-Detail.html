<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="StickIn" content="This is the Stick IN Home Page" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="stylesheet" href="../CSS/Sidebar.css" />
    <link rel="stylesheet" href="../CSS/Gamelist.css" />
    <title>Detail</title>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- GSAP Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r146/three.min.js"></script>
    <style>
      main {
        color: #ffffff;
      }

      .container {
        background-color: #1a1a1a;
        max-width: 800px;
        margin: auto;
        padding: 20px;
        text-align: left;
      }

      .header {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .character-image {
        width: 200px;
        height: auto;
        object-fit: cover;
        border-radius: 10px;
        border: 1px solid #333;
      }
      .weapon img {
        width: 50px;
        vertical-align: middle;
        margin-right: 5px;
      }

      .element img {
        width: 50px;
        vertical-align: middle;
        margin-right: 5px;
      }

      .basic-info {
        flex: 1;
      }

      .description {
        line-height: 1.5;
        margin-top: 10px;
        color: #cccccc;
      }

      .button-list {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .tab-button {
        padding: 10px 20px;
        border: none;
        background-color: #333;
        color: #fff;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .tab-button.active {
        background-color: #007bff;
      }

      .tab-button:hover:not(.active) {
        background-color: #444;
      }

      .content-area {
        padding: 20px;
        border-radius: 5px;
        min-height: 200px;
        background-color: #2a2a2a;
      }
      .tab-title {
        font-size: 12px;
      }

      /* Profile Card Styles */
      .card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 0 1rem;
        margin-bottom: 0.5rem;
        color: white;
        border: 0;
        border-radius: 50px;
        height: 50px;
        transition: background-color 0.3s;
      }

      .card p {
        margin: 0;
        font: bold 1.5em Verdana, sans-serif;
      }

      .card i {
        float: right;
        padding: 4px;
      }
      /* Voice Actors Section */

      .voice-actors-section {
        margin-top: 20px;
        padding: 15px;
        background-color: #2a2a2a;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .section-title {
        font-size: 1.2em;
        color: #ffffff;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .va-list {
        list-style: none;
        padding: 0;
      }

      .va-item {
        margin-bottom: 8px;
        padding: 5px 10px;
        background-color: #333;
        border-radius: 3px;
        transition: background-color 0.3s;
      }

      .va-item:hover {
        background-color: #444;
      }

      .va-lang {
        font-weight: bold;
        color: #b8860b; /* Golden color for flair */
        margin-right: 10px;
      }

      .va-name {
        color: #cccccc;
        text-decoration: none;
      }

      .va-name:hover {
        color: #007bff;
        text-decoration: underline;
      }

      .names-section {
        margin-top: 20px;
        padding: 15px;
        background-color: #2a2a2a;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .names-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
      }

      .name-card {
        background-color: #333;
        padding: 8px;
        border-radius: 5px;
        text-align: center;
        transition: transform 0.2s, background-color 0.3s;
      }

      .name-card:hover {
        transform: scale(1.05);
        background-color: #444;
      }

      .lang-label {
        font-weight: bold;
        color: #b8860b;
        display: block;
        margin-bottom: 5px;
      }

      .lang-name {
        color: #cccccc;
        font-style: italic;
      }

      .aff-link {
        color: #007bff;
        text-decoration: none;
      }

      .aff-link:hover {
        text-decoration: underline;
        color: #0056b3;
      }

      ruby {
        ruby-position: over;
        ruby-align: center;
      }

      rt {
        font-size: 0.6em;
        color: #cccccc;
      }

      /* Rarity-based colors */
      .rarity-common {
        background-color: #4a4a4a;
      }
      .rarity-uncommon {
        background-color: #2d6a4f;
      }
      .rarity-rare {
        background-color: #1e3a8a;
      }
      .rarity-epic {
        background-color: #4c2c72;
      }
      .rarity-legendary {
        background-color: #b8860b;
      }
      .general-bg {
        background-color: #713a96;
      }

      /* Table Styles */
      .table-striped {
        width: 100%;
        margin-bottom: 1rem;
        border: 1px solid #444;
        border-radius: 4px;
      }

      .table-striped tr:nth-child(odd) {
        background-color: #333;
      }

      .table-striped tr:nth-child(even) {
        background-color: #2a2a2a;
      }

      .table-striped td {
        padding: 0.25rem 0.5rem;
      }

      /* Custom column widths */
      .row {
        display: flex;
        flex-wrap: wrap;
        margin: 0;
      }

      .col-3 {
        flex: 0 0 25%;
        max-width: 25%;
      }

      .col-6 {
        flex: 0 0 50%;
        max-width: 50%;
      }

      .text-right {
        text-align: right;
      }

      .font-weight-bold {
        font-weight: bold;
      }

      .voice-section {
        margin-top: 10px;
      }

      .voice-list {
        margin-bottom: 15px;
      }

      .voice-item {
        padding: 8px;
        background-color: #333;
        margin-bottom: 5px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .voice-item:hover {
        background-color: #444;
      }

      .voice-player {
        margin-top: 15px;
      }

      #voiceAudio {
        width: 100%;
        max-width: 300px;
        background-color: #333;
        border-radius: 5px;
      }

      #currentVoice {
        margin-top: 5px;
        color: #cccccc;
        font-size: 0.9em;
      }

      .sequence-container {
        display: flex;
        flex-direction: column;
        gap: 0; /* No gap between card and description */
      }

      .sequence-description {
        background-color: #2a2a2a;
        color: #cccccc;
        border-radius: 0 0 5px 5px; /* Rounded bottom corners */
      }

      .upgrade-container-alt {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .upgrade-card {
        border: 1px solid #444;
        border-radius: 8px;
        overflow: hidden;
      }

      .upgrade-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: background-color 0.3s;
      }

      .upgrade-header:hover {
        background-color: #4a4a4a !important; /* Override inline style on hover */
      }

      .upgrade-materials-alt {
        color: #ffffff;
      }

      .upgrade-materials-alt ul li {
        padding: 5px 0;
        font-size: 0.95em;
      }
      .skill {
        padding: 15px;
        margin-top: 15px;
        margin-bottom: 15px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.7);
      }
      input[type="range"] {
        width: 100%;
      }
      pre {
        background: #eee;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
      }

      .dark-table {
        width: 100%;
        border-collapse: collapse;
        background-color: #1e1e1e;
        color: #fff;
        margin-top: 10px;
        font-size: 14px;
      }

      .dark-table th,
      .dark-table td {
        padding: 10px;
        border: 1px solid #333;
        text-align: left;
      }

      .dark-table th {
        background-color: #333;
      }

      input[type="range"] {
        accent-color: #eee;
      }

      @media (max-width: 576px) {
        .col-3 {
          flex: 0 0 50%;
          max-width: 50%;
        }
        .col-6 {
          flex: 0 0 50%;
          max-width: 50%;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <div class="container">
        <div id="character-container">
          <p>Loading character data...</p>
        </div>
        <div class="button-list">
          <button class="tab-button active" data-tab="profile">Profile</button>
          <button class="tab-button" data-tab="backstory">Backstory</button>
          <button class="tab-button" data-tab="battle">Battle</button>
          <button class="tab-button" data-tab="skill">Skills</button>
          <button class="tab-button" data-tab="levelUpgrade">
            Level Upgrade
          </button>
          <button class="tab-button" data-tab="skillUpgrade">
            Skill Upgrade
          </button>
          <button class="tab-button" data-tab="voice">Voice</button>
          <button class="tab-button" data-tab="dupe">Resonance Chain</button>
          <button class="tab-button" data-tab="gallery">Gallery</button>
        </div>

        <div class="content-area" id="content">
          <div class="card rarity-legendary">
            <p>
              Character Name (Legendary)
              <i class="fa fa-id-card"></i>
            </p>
          </div>
          <table class="table-striped"></table>
        </div>
      </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

    <script src="../JS/Sidebar.js"></script>

    <script>
      const buttons = document.querySelectorAll(".tab-button");
      const contentArea = document.getElementById("content");
      let characterData = null;
      let currentCharacterName = null;
      let backstoryData = null;

      async function fetchCharacterData() {
        try {
          const response = await fetch(
            "https://raw.githubusercontent.com/GachaDB/wuthering-wave-db/refs/heads/main/Asset/Json/Character_Details/profile_data.json"
          );
          characterData = await response.json();
          console.log("Character data fetched successfully");
        } catch (error) {
          console.error("Error fetching character data:", error);
          characterData = null;
        }
      }

      function getCharacterData(characterName) {
        if (!characterData) {
          console.error("Character data not loaded yet");
          return null;
        }

        const character = characterData.find(
          (char) => char.name.toLowerCase() === characterName.toLowerCase()
        );

        if (!character) {
          console.error("Character not found");
          return null;
        }
        currentCharacterName = character.name || "Unknown";
        document.title = `${currentCharacterName}'s Detail`;

        const stars = "⭐".repeat(character.rarity || 0);

        let descriptionHTML = "";
        if (character.quotes && character.quotes.length > 0) {
          descriptionHTML = character.quotes
            .map((quote) => {
              if (Array.isArray(quote.text)) {
                return `<p class="description">${quote.text.join("<br>")}</p>`;
              }
              return `<p class="description">${quote.text}</p>`;
            })
            .join("");
        } else {
          descriptionHTML =
            '<p class="description">No quotes available for this character.</p>';
        }

        // Call tabContent with the character object
        const tabs = tabContent(character);
        contentArea.innerHTML = tabs.profile;

        const html = `
        <div class="container">
            <div class="header">
                <img
                    src="https://raw.githubusercontent.com/GachaDB/Wuthering-Waves-Assets/refs/heads/main/resonator/Character%20Model/${encodeURIComponent(
                      character.name
                    )}_Full_Sprite.webp"
                    alt="${character.name} Image"
                    class="character-image"
                />
                <div class="basic-info">
                    <h1>${character.name}</h1>
                    <div>
                        <span class="rarity">${stars}</span>|<span class="weapon">
                            <img 
                                src="https://raw.githubusercontent.com/GachaDB/Wuthering-Waves-Assets/refs/heads/main/weapon/${encodeURIComponent(
                                  character.weapon
                                )}_Weapon_Icon.webp" 
                                alt="${character.weapon}"
                            >
                            ${character.weapon}
                        </span>|<span class="element">
                            <img 
                                  src="https://raw.githubusercontent.com/GachaDB/Wuthering-Waves-Assets/refs/heads/main/element/${encodeURIComponent(
                                    character.element
                                  )}_Element_Icon.webp" 
                                  alt="${character.element}"
                              >
                            ${character.element}</span>
                    </div>
                    ${descriptionHTML}
                </div>
            </div>
        </div>
    `;

        return html;
      }

      function getParameterByName(name) {
        const url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
        const results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      async function displayCharacterFromUrl() {
        if (!characterData) {
          await Promise.all([fetchCharacterData(), loadBackstoryData()]);
        }

        const characterName = getParameterByName("r");
        if (!characterName) {
          document.getElementById("character-container").innerHTML =
            "<p>No character specified in URL</p>";
          return;
        }

        const characterHTML = getCharacterData(characterName);
        if (characterHTML) {
          document.getElementById("character-container").innerHTML =
            characterHTML;
        } else {
          document.getElementById(
            "character-container"
          ).innerHTML = `<p>Character "${characterName}" not found</p>`;
        }
      }

      window.onload = displayCharacterFromUrl;


      async function loadBackstoryData() {
  try {
    const response = await fetch(
      "https://raw.githubusercontent.com/GachaDB/wuthering-wave-db/refs/heads/main/Asset/Json/Character_Details/backstory_data.json"
    );
    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
    backstoryData = await response.json();
    console.log("Backstory data fetched successfully");
  } catch (error) {
    console.error("Error fetching backstory data:", error);
    backstoryData = null;
  }
}


      // Modify the existing button click handler
      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          buttons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
          const tab = button.dataset.tab;
          contentArea.innerHTML = tabContent[tab];

          if (tab === "voice") {
            setTimeout(initializeVoicePlayer, 0);
          } else if (tab === "levelUpgrade" || tab === "skillUpgrade") {
            setTimeout(initializeUpgradeCards, 0);
          }
        });
      });

      // Add this after the existing buttons.forEach loop
      function initializeVoicePlayer() {
        const voiceItems = document.querySelectorAll(".voice-item");
        const audioPlayer = document.getElementById("voiceAudio");
        const currentVoiceText = document.getElementById("currentVoice");

        if (voiceItems && audioPlayer && currentVoiceText) {
          voiceItems.forEach((item) => {
            item.addEventListener("click", () => {
              const audioUrl = item.getAttribute("data-audio");
              const voiceText = item.textContent.split(" - ")[0]; // Get the title before the description
              audioPlayer.src = audioUrl;
              audioPlayer.play();
              currentVoiceText.textContent = `Current: ${voiceText}`;
            });
          });
        }
      }

      // Define upgrade data
      const upgradeData = {
        levelUpgrades: {
          totalCost: { gold: 1000, ironOre: 50, mysticShard: 25 },
          levels: [
            {
              from: 1,
              to: 2,
              materials: { gold: 100, ironOre: 5, mysticShard: 2 },
            },
            {
              from: 2,
              to: 3,
              materials: { gold: 200, ironOre: 10, mysticShard: 5 },
            },
            {
              from: 3,
              to: 4,
              materials: { gold: 300, ironOre: 15, mysticShard: 8 },
            },
            {
              from: 4,
              to: 5,
              materials: { gold: 400, ironOre: 20, mysticShard: 10 },
            },
          ],
        },
        skillUpgrades: {
          totalCost: { gold: 900, ironOre: 45, mysticShard: 25 },
          skills: [
            {
              name: "Elemental Mastery",
              maxLevel: 3,
              upgrades: [
                {
                  from: 1,
                  to: 2,
                  materials: { gold: 100, ironOre: 5, mysticShard: 3 },
                },
                {
                  from: 2,
                  to: 3,
                  materials: { gold: 200, ironOre: 10, mysticShard: 7 },
                },
              ],
            },
            {
              name: "Enhanced Strength",
              maxLevel: 4,
              upgrades: [
                {
                  from: 1,
                  to: 2,
                  materials: { gold: 100, ironOre: 5, mysticShard: 2 },
                },
                {
                  from: 2,
                  to: 3,
                  materials: { gold: 150, ironOre: 8, mysticShard: 4 },
                },
                {
                  from: 3,
                  to: 4,
                  materials: { gold: 200, ironOre: 12, mysticShard: 6 },
                },
              ],
            },
            {
              name: "Light Manipulation",
              maxLevel: 2,
              upgrades: [
                {
                  from: 1,
                  to: 2,
                  materials: { gold: 150, ironOre: 5, mysticShard: 3 },
                },
              ],
            },
          ],
        },
      };

      // Function to generate total cost HTML
      function generateTotalCost(totalCost, title) {
        return `
        <div class="total-cost" style="background-color: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444;">
            <h3>${title}</h3>
            <ul style="list-style: none; padding: 0; margin-top: 10px;">
                <li><span style="color: #ffd700;">${totalCost.gold} Gold</span></li>
                <li><span style="color: #b0b0b0;">${totalCost.ironOre} Iron Ore</span></li>
                <li><span style="color: #00b7eb;">${totalCost.mysticShard} Mystic Shard</span></li>
            </ul>
        </div>
    `;
      }

      // Function to generate upgrade card HTML
      function generateUpgradeCard(id, title, materialsList) {
        const materialsHtml = materialsList
          .map(
            (m) => `
        <li>Lv ${m.from} → Lv ${m.to}:</li>
        <li><span style="color: #ffd700;">${m.materials.gold} Gold</span></li>
        <li><span style="color: #b0b0b0;">${m.materials.ironOre} Iron Ore</span></li>
        <li><span style="color: #00b7eb;">${m.materials.mysticShard} Mystic Shard</span></li>
    `
          )
          .join("");
        return `
        <div class="upgrade-card" data-upgrade="${id}">
            <div class="upgrade-header" style="background-color: #3a3a3a; padding: 10px 15px; border-radius: 8px 8px 0 0; cursor: pointer;">
                <span>${title}</span>
                <i class="fas fa-chevron-down" style="float: right;"></i>
            </div>
            <div class="upgrade-materials-alt" background-color: #252525; padding: 15px; border-radius: 0 0 8px 8px;">
                <ul style="list-style: none; padding: 0;">
                    ${materialsHtml}
                </ul>
            </div>
        </div>
    `;
      }

      // Function to generate level upgrade tab HTML
      function generateLevelUpgradeTab() {
        const levelCards = upgradeData.levelUpgrades.levels
          .map((level) =>
            generateUpgradeCard(
              `level-${level.from}-${level.to}`,
              `Level ${level.from} → Level ${level.to}`,
              [level]
            )
          )
          .join("");

        return `
        <h2>Level Up Upgrade Cost</h2>
        ${generateTotalCost(
          upgradeData.levelUpgrades.totalCost,
          "Total Level Upgrade Cost (Level 1 → Level 5)"
        )}
        <div class="upgrade-container-alt">
            ${levelCards}
        </div>
    `;
      }

      // Function to generate skill upgrade tab HTML
      function generateSkillUpgradeTab() {
        const skillCards = upgradeData.skillUpgrades.skills
          .map((skill) =>
            generateUpgradeCard(
              `skill-${skill.name.toLowerCase().replace(/\s+/g, "-")}`,
              `${skill.name} (Lv 1 → Lv ${skill.maxLevel})`,
              skill.upgrades
            )
          )
          .join("");

        return `
        <h2>Skill Upgrade Cost</h2>
        ${generateTotalCost(
          upgradeData.skillUpgrades.totalCost,
          "Total Skill Upgrade Cost (All Skills to Max)"
        )}
        <div class="upgrade-container-alt">
            ${skillCards}
        </div>
    `;
      }

      function initializeUpgradeCards() {
        const upgradeHeaders = document.querySelectorAll(".upgrade-header");
        upgradeHeaders.forEach((header) => {
          // Set initial state to open
          const materials = header.nextElementSibling;
          const chevron = header.querySelector("i");
          materials.style.display = "none";
          chevron.classList.remove("fa-chevron-up");
          chevron.classList.add("fa-chevron-down");

          // Add click event listener to toggle visibility
          header.addEventListener("click", (event) => {
            if (materials.style.display === "none") {
              materials.style.display = "block";
              chevron.classList.remove("fa-chevron-down");
              chevron.classList.add("fa-chevron-up");
            } else {
              materials.style.display = "none";
              chevron.classList.remove("fa-chevron-up");
              chevron.classList.add("fa-chevron-down");
            }
          });
        });
      }

      // Function to load skills dynamically
      function loadSkills() {
        const skills = [
          {
            name: "Spectro Slash",
            user: "Jinhsi",
            description: "Attack the target, dealing Spectro DMG.",
            stats: {
              skillDMG: [
                "251.40%+586.60%",
                "272.02%+634.71%",
                "292.63%+682.81%",
                "321.50%+750.15%",
              ],
              cooldown: ["24s", "24s", "20s", "20s"],
              resonanceCost: ["150", "140", "120", "100"],
            },
            multipliers: {
              lv1: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "80%",
                  resonanceEnergy: "10",
                  concertoEnergy: "0",
                  hardness: "1",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "120%",
                  resonanceEnergy: "10",
                  concertoEnergy: "0",
                  hardness: "1",
                  toughness: "1",
                },
              ],
              lv2: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "90%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "135%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
              ],
              lv3: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "100%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "150%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
              ],
              lv4: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "110%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "165%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
              ],
            },
          },
          {
            name: "Spectro Slash 2",
            user: "Jinhsi",
            description: "Attack the target, dealing Spectro DMG.",
            stats: {
              skillDMG: [
                "251.40%+586.60%",
                "272.02%+634.71%",
                "292.63%+682.81%",
                "321.50%+750.15%",
              ],
              cooldown: ["24s", "24s", "20s", "20s"],
              resonanceCost: ["150", "140", "120", "100"],
            },
            multipliers: {
              lv1: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "80%",
                  resonanceEnergy: "10",
                  concertoEnergy: "0",
                  hardness: "1",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "120%",
                  resonanceEnergy: "10",
                  concertoEnergy: "0",
                  hardness: "1",
                  toughness: "1",
                },
              ],
              lv2: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "90%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "135%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
              ],
              lv3: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "100%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "150%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
              ],
              lv4: [
                {
                  entry: 1,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "110%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
                {
                  entry: 2,
                  attribute: "ATK",
                  attackType: "Inherent Skill",
                  damageType: "Damage",
                  skillValue: "165%",
                  resonanceEnergy: "12",
                  concertoEnergy: "0",
                  hardness: "2",
                  toughness: "1",
                },
              ],
            },
          },
        ];

        const container = document.getElementById("skills-container");
        if (!container) return;

        container.innerHTML = ""; // Clear previous skills

        skills.forEach((skill, index) => {
          const skillDiv = document.createElement("div");
          skillDiv.classList.add("skill");

          skillDiv.innerHTML = `
            <h2 style="color: #f5f5f5;">${skill.name}</h2>
            <p style="color: #ddd;">${skill.description}</p>
			<div style="text-align: right;">
				<label class="level-display" style="color: #f5f5f5;">
					Skill Level: <span id="level-display-${index}">1</span>
				</label>
			</div>
            <input type="range" id="skill-slider-${index}" min="1" max="4" value="1" step="1" style="width: 100%;">
			<div style="text-align: center;">
            	<h3 style="color: #f5f5f5;">Stats</h3>
			</div>
            <table class="dark-table">
                <tr><th>Skill DMG</th><td id="skill-dmg-${index}">${
            skill.stats.skillDMG[0]
          }</td></tr>
                <tr><th>Cooldown</th><td id="cooldown-${index}">${
            skill.stats.cooldown[0]
          }</td></tr>
                <tr><th>Resonance Cost</th><td id="res-cost-${index}">${
            skill.stats.resonanceCost[0]
          }</td></tr>
            </table>

            <h3 style="color: #f5f5f5; margin-top: 20px;">Multipliers</h3>
			<table id="multipliers-table-${index}" class="dark-table">
				${generateMultiplierRows(skill.multipliers.lv1)}
			</table>
        `;

          container.appendChild(skillDiv);

          document
            .getElementById(`skill-slider-${index}`)
            .addEventListener("input", (event) => {
              const level = event.target.value - 1; // Adjusting index (array starts at 0)
              document.getElementById(`level-display-${index}`).innerText =
                level + 1;
              document.getElementById(`skill-dmg-${index}`).innerText =
                skill.stats.skillDMG[level];
              document.getElementById(`cooldown-${index}`).innerText =
                skill.stats.cooldown[level];
              document.getElementById(`res-cost-${index}`).innerText =
                skill.stats.resonanceCost[level];

              const multipliersKey = `lv${level + 1}`;
              document.getElementById(`multipliers-table-${index}`).innerHTML =
                generateMultiplierRows(skill.multipliers[multipliersKey]);
            });
        });
      }

      function generateMultiplierRows(multiplierData) {
        let rows = `
        <tr>
            <th>Entry</th>
            <th>Attribute</th>
            <th>Attack Type</th>
            <th>Damage Type</th>
            <th>Skill Value</th>
            <th>Resonance Energy</th>
            <th>Concerto Energy</th>
            <th>Hardness</th>
            <th>Toughness</th>
        </tr>`;

        multiplierData.forEach((multiplier) => {
          rows += `
            <tr>
                <td>${multiplier.entry}</td>
                <td>${multiplier.attribute}</td>
                <td>${multiplier.attackType}</td>
                <td>${multiplier.damageType}</td>
                <td>${multiplier.skillValue}</td>
                <td>${multiplier.resonanceEnergy}</td>
                <td>${multiplier.concertoEnergy}</td>
                <td>${multiplier.hardness}</td>
                <td>${multiplier.toughness}</td>
            </tr>`;
        });

        return rows;
      }

      // Tab switching logic
      function generateProfileTab(character) {
        const rarityMap = {
          1: "common",
          2: "uncommon",
          3: "rare",
          4: "epic",
          5: "legendary",
        };
        const rarityStars = "⭐".repeat(character.rarity || 0);
        const name = character.name || "n/a";
        const birthday = character.birthday || "n/a";
        const title = character.title || "n/a";
        const gender = character.gender || "n/a";
        const classType = character.class || "n/a";
        const affiliations =
          character.affiliations
            ?.map(
              (aff) =>
                `- <a href="${aff.link}" target="_blank" class="aff-link">${aff.name}</a>`
            )
            .join("<br>") || "n/a";
        const weapon = character.weapon || "n/a";
        const element = character.element || "n/a";
        const releaseDate = character.release_date || "n/a";
        const birthplace = character.birthplace || "n/a";
        const nation = character.nation || "n/a";
        const specialDish = character.special_dish?.name || "n/a";
        const rarityClass = `rarity-${rarityMap[character.rarity] || "common"}`;
        const formattedName = splitAndFormatJapaneseName(
          character.official_names_by_language.jp
        );

        // Voice Actors
        const voiceActors = character.voice_actors
          ? `
        <div class="voice-actors-section">
            <h3 class="section-title"><i class="fas fa-microphone-alt"></i> Voice Actors</h3>
            <ul class="va-list">
                ${Object.entries(character.voice_actors)
                  .map(
                    ([lang, va]) => `
                    <li class="va-item">
                        <span class="va-lang">${
                          lang.charAt(0).toUpperCase() + lang.slice(1)
                        }:</span>
                        <a href="${va.link}" target="_blank" class="va-name">${
                      va.name
                    }</a>
                    </li>
                `
                  )
                  .join("")}
            </ul>
        </div>
    `
          : "<p>No voice actor information available.</p>";

        function splitAndFormatJapaneseName(mixedName) {
          if (!mixedName || !/[\u4E00-\u9FFF]/.test(mixedName)) {
            return mixedName || "n/a"; // Return as-is if no kanji or empty
          }

          // Split into kanji and katakana parts
          const chars = mixedName.split("");
          let kanji = "";
          let furigana = "";
          for (let i = 0; i < chars.length; i++) {
            const isKanji = /[\u4E00-\u9FFF]/.test(chars[i]);
            if (isKanji) {
              kanji += chars[i];
            } else {
              furigana += chars[i];
            }
          }

          // Distribute furigana across kanji
          const kanjiChars = kanji.split(""); // ["今", "汐"]
          let rubyHTML = "";

          if (kanjiChars.length === 2 && furigana === "コンシ") {
            // Hardcoded for "今コン汐シ" case; ideally, this would be more dynamic
            rubyHTML = `<ruby>今<rt>コン</rt></ruby><ruby>汐<rt>シ</rt></ruby>`;
          } else {
            // Fallback: split furigana evenly or adjust based on length
            const furiganaHalf = Math.ceil(furigana.length / kanjiChars.length);
            for (let i = 0; i < kanjiChars.length; i++) {
              const start = i * furiganaHalf;
              const end = start + furiganaHalf;
              const furiganaPart = furigana.slice(start, end) || "";
              rubyHTML += `<ruby>${kanjiChars[i]}<rt>${furiganaPart}</rt></ruby>`;
            }
          }

          return rubyHTML;
        }

        // Updated officialNames in generateProfileTab
        const officialNames = character.official_names_by_language
          ? `
    <div class="names-section">
        <h3 class="section-title"><i class="fas fa-globe"></i> Names Across the World</h3>
        <div class="names-grid">
            ${Object.entries(character.official_names_by_language)
              .map(([lang, langName]) => {
                // Apply furigana formatting only to Japanese
                const displayName =
                  lang.toLowerCase() === "japanese" &&
                  /[\u4E00-\u9FFF]/.test(langName)
                    ? splitAndFormatJapaneseName(langName)
                    : langName;
                return `
                    <div class="name-card">
                        <span class="lang-label">${lang}:</span>
                        <span class="lang-name">${displayName}</span>
                    </div>
                `;
              })
              .join("")}
        </div>
    </div>
`
          : "<p>No alternate names available.</p>";

        return `
        <div class="card ${rarityClass} tab-title">
            <p>${name} (${rarityStars})
                <i class="fa fa-id-card"></i>
            </p>
        </div>
        <table class="table-striped">
            <tr class="row">
                <td class="col-3 text-right font-weight-bold">Name:</td>
                <td class="col-3">${name}</td>
                <td class="col-3 text-right font-weight-bold">Birthday:</td>
                <td class="col-3">${birthday}</td>
            </tr>
            <tr class="row">
                <td class="col-3 text-right font-weight-bold">Title:</td>
                <td class="col-3">${title}</td>
                <td class="col-3 text-right font-weight-bold">Gender:</td>
                <td class="col-3">${gender}</td>
            </tr>
            <tr class="row">
                <td class="col-3 text-right font-weight-bold">Class:</td>
                <td class="col-3">${classType}</td>
                <td class="col-3 text-right font-weight-bold">Element:</td>
                <td class="col-3">${element}</td>
            </tr>
            <tr class="row">
                <td class="col-3 text-right font-weight-bold">Weapon:</td>
                <td class="col-3">${weapon}</td>
                <td class="col-3 text-right font-weight-bold">Birthplace:</td>
                <td class="col-3">${birthplace}</td>
            </tr>
            <tr class="row">
                <td class="col-3 text-right font-weight-bold">Nation:</td>
                <td class="col-3">${nation}</td>
                <td class="col-3 text-right font-weight-bold">Special Dish:</td>
                <td class="col-3">${specialDish}</td>
            </tr>
            <tr class="row">
                <td class="col-3 text-right font-weight-bold">Affiliation:</td>
                <td class="col-3">${affiliations}</td>
                <td class="col-3 text-right font-weight-bold">Release Date:</td>
                <td class="col-3">${releaseDate}</td>
            </tr>
        </table>
        ${voiceActors}
        ${officialNames}
    `;
      }

      function generateBackstoryTab(character) {
        return `
        <h2>Backstory</h2>
        <p>Born in a small village ravaged by war, the character discovered their powers at a young age. 
        After losing their family to a dark force, they vowed to protect the innocent and bring justice 
        to the realm.</p>
    `;
      }

      function generateBackstoryTab(characterName) {
  if (!backstoryData) {
    return `
      <div class="backstory-container">
        <h2>Backstory</h2>
        <p>Loading character data...</p>
      </div>
    `;
  }

  const characterData = Array.isArray(backstoryData)
    ? backstoryData.find(item => item.name.toLowerCase() === characterName.toLowerCase())
    : backstoryData.name.toLowerCase() === characterName.toLowerCase() ? backstoryData : null;

  if (!characterData) {
    return `
      <div class="backstory-container">
        <h2>Backstory</h2>
        <p>No backstory found for ${characterName}</p>
      </div>
    `;
  }

  const storiesHTML = characterData.characterStories.map(story => `
    <div class="story-section">
      <h3>${story.title}</h3>
      <p class="unlock-requirement">${story.unlockRequirement}</p>
      ${story.content.map(paragraph => `<p>${paragraph}</p>`).join("")}
    </div>
  `).join("");

  return `
    <div class="backstory-container">
      <h2>Backstory: ${characterData.name}</h2>
      <div class="character-info">
        <h3>Personality</h3>
        ${characterData.personality.map(p => `<p>${p}</p>`).join("")}
        <h3>Appearance</h3>
        ${characterData.appearance.map(a => `<p>${a}</p>`).join("")}
        <h3>Basic Information</h3>
        <p>${characterData.archive.basicInformation}</p>
      </div>
      <div class="character-stories">
        ${storiesHTML}
      </div>
    </div>
  `;
}

      function generateVoiceTab() {
        return `
        <h2>Voice</h2>
        <div class="voice-section">
            <ul class="voice-list" style="list-style: none; padding: 0;">
                <li class="voice-item" data-audio="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3">Greeting - "Welcome to my realm!"</li>
                <li class="voice-item" data-audio="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3">Battle Cry - "For justice!"</li>
                <li class="voice-item" data-audio="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3">Victory - "The light prevails!"</li>
            </ul>
            <div class="voice-player">
                <audio id="voiceAudio" controls>
                    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                <p id="currentVoice">Current: Greeting</p>
            </div>
        </div>
    `;
      }

      function generateDupeTab() {
        return `
        <h2>Sequence Upgrades</h2>
        <div class="sequence-container">
            <div class="card general-bg tab-title" style="border: 2px solid #555;">
                <p>S1 | Abyssal Ascension</p>
            </div>
            <div class="sequence-description" style="border: 2px solid #555; border-top: none; padding: 10px; margin-bottom: 15px;">
                <p>Add stats by 15%</p>
            </div>
            <div class="card general-bg tab-title" style="border: 2px solid #555;">
                <p>S2 | Sequence Node 2</p>
            </div>
            <div class="sequence-description" style="border: 2px solid #555; border-top: none; padding: 10px;">
                <p>Skill becomes AoE</p>
            </div>
        </div>
    `;
      }

      // Modify the existing button click handler
      buttons.forEach((button) => {
        button.addEventListener("click", () => {
          // Remove active class from all buttons
          buttons.forEach((btn) => btn.classList.remove("active"));

          // Add active class to the clicked button
          button.classList.add("active");

          const tab = button.dataset.tab;
          const character = characterData.find(
            (char) =>
              char.name.toLowerCase() === currentCharacterName.toLowerCase()
          );

          if (character) {
            const tabs = tabContent(character); // Pass the character object
            contentArea.innerHTML =
              tabs[tab] ||
              `<h2 style="color: white;">${tab} Content Coming Soon...</h2>`;

            if (tab === "skill") {
              loadSkills();
            }
          } else {
            contentArea.innerHTML = `<h2 style="color: white;">Character data not available</h2>`;
          }
        });
      });
      const tabContent = (character) => ({
        profile: generateProfileTab(character),
        backstory: generateBackstoryTab(character.name),
        skill: generateSkillTab(character),
        voice: generateVoiceTab(character),
        dupe: generateDupeTab(character),
        levelUpgrade: generateLevelUpgradeTab(character),
        skillUpgrade: generateSkillUpgradeTab(character),
      });
    </script>
  </body>
</html>
